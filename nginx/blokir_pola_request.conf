## Blokir request aneh dan mencurigakan
## By method selain GET dan POST
#if ($request_method !~ ^(GET|POST)$) { return 403; } # jangan aktif karena ada request dari crawler google atau library  tcpdf yang get gambar (tc-lib-file) pakai method HEAD
## By karakter yang ada di URL
if ($request_uri ~* "ALFA_DATA|alfacgi|alfa-rex|alfanew|www\.slims\.web\.id|\.env|info\.php|<script>|%3Cscript%3E|%3C/script%3E|onerror=|onload=|%3Cimg|javascript:|<iframe|%3Ciframe|document\.cookie|alert\(document\.domain\)|%22%3E%3Cscript%3E|\.\./|%2e%2e|%252e|%5c|%2f%2e%2e|\.\.%2f|\.\.%5c|/etc/passwd|togel|\?ios|\?bet|\?down/") { return 403; }
## Allow & ignore all .well-known request from logging
location ~ /.well-known {
  auth_basic off;
  allow all;
  access_log off;
  log_not_found off;
}
## Disable all access to the following directories
location ~ /(app|assets|ide|sites|wordpress)$ { return 403; }
## Block any exploits that does not want any email notice
location ~* /(downloader|apple-app-site-association|bea_wls_deployment_internal|HNAP1|console|recordings|alfacgiapi|ALFA_DATA|indoxploit)$ { return 403; }
## Block common exploits
location ~* /(assets|files|uploads|tmp|resources|static|wp-includes|wp-content)/.*\.phtml$ { return 403; }
location ~* /(assets|files|uploads|tmp|resources|static|wp-includes|wp-content)/.*\.php$ { return 403; }
location ~* /(assets|files|uploads|tmp|resources|static|wp-includes|wp-content)/.*\.asp$ { return 403; }
location ~* /(assets|files|uploads|tmp|resources|static|wp-includes|wp-content)/.*\.rb$ { return 403; }
location ~* /(assets|files|uploads|tmp|resources|static|wp-includes|wp-content)/.*\.py$ { return 403; }
location ~* \.(pl|cgi|py|sh|lua|exe|ini|pot|htc|esp|asp|action|alfa)$ { return 403; }
if ($request_method !~ ^(GET|HEAD|POST)$ ) { return 403; }
if ($args ~* "mosConfig_[a-zA-Z_]{1,21}(=|%3D)") { return 403; }
## Block SQL injections
if ($args ~* "(%3D0x|%280x|%200x|%270x|\/\*|\*\/|\||&&|--|\'|#|@@)") { return 403; }
if ($args ~* "(select%20|union%20|all%20|case%20|when%20|then%20|else%20|from%20|insert%20|update%20|delete%20|drop%20|and%20|or%20|group%20|table%20|declare%20|--%20|concat%28|md5%28|ascii%28|chr%28|hex%28|unhex%28|sleep%28|%20end|%20numeric|%20null)") { return 403; }
## Block obvious RFI
if ($args ~* "(http:|https:|ftp:|php:|sftp:|zlib:|data:|glob:|phar:|gopher:)") { return 403; }
## Block directory traversal
if ($args ~* "etc/passwd") { return 403; } # obvious probe
if ($args ~* "c:") { return 403; } # obvious windows path
if ($args ~* "cmd.exe") { return 403; } # obvious probe
## HTTP Response Splitting / HTTP Header Injection
if ($request_uri ~* "%0D|%0A") { return 403; }
if ($request_uri ~* "headername:%20") { return 403; }
## Cross Site Scripting
#if ($args ~* "(<|%3C|>|%3E|[|]|~|`)") { return 403; }
if ($args ~* "(<script|<svg|<img|%3C|<|>|%3E|[|]|~|`)") { return 403; }
## Evading tricks
if ($args ~* "(&#|%U)") { return 403; }
## Common nginx configuration to block sql injection and other attacks
location ~* "(eval\()"  { return 403; }
location ~* "(127\.0\.0\.1)"  { return 403; }
location ~* "([a-z0-9]{2000})"  { return 403; }
location ~* "(javascript\:)(.*)(\;)"  { return 403; }
location ~* "(base64_encode)(.*)(\()"  { return 403; }
location ~* "(GLOBALS|REQUEST)(=|\[|%)"  { return 403; }
location ~* "(<|%3C).*script.*(>|%3)" { return 403; }
location ~ "(\\|\.\.\.|\.\./|~|`|<|>|\|)" { return 403; }
location ~* "(boot\.ini|etc/passwd|self/environ)" { return 403; }
location ~* "(thumbs?(_editor|open)?|tim(thumb)?)\.php" { return 403; }
location ~* "(\'|\")(.*)(base64|encode|decode|environ|globals|ini_set|localhost|loopback|magic_quotes|root|sessionid|soap|webdav|bash|git|hg|ht|svn|swp|cvs)" { return 403; }
location ~* "(\'|\")(.*)(request|drop|insert|md5|select|update|delete|union|concat|table|from|ascii|hex|unhex|declare)" { return 403; }
location ~* "(https?|ftp|php):/" { return 403; }
location ~* "(=\\\'|=\\%27|/\\\'/?)\." { return 403; }
location ~* "/(\$(\&)?|\"|\.|,|&|&amp;?)/?$" { return 403; }
location ~ "(\{0\}|\(/\(|\.\.\.|\+\+\+|\\\"\\\")" { return 403; }
location ~ "(~|`|<|>|:|;|%|\\|\s|\{|\}|\[|\]|\|)" { return 403; }
location ~* "/(=|\$&|_mm|(wp-)?config\.|cgi-|etc/passwd|muieblack)" { return 403; }
location ~* "(&pws=0|_vti_|\(null\)|\{\$itemURL\}|echo(.*)kae|etc/passwd|eval\(|self/environ)" { return 403; }
location ~* "\.(aspx?|bash|bak?|cfg|cgi|dll|exe|git|hg|ini|jsp|log|mdb|out|sql|svn|swp|tar|rdf)$" { return 403; }
location ~* "/(^$|mobiquo|phpinfo|shell|sqlpatch|thumb|thumb_editor|thumbopen|timthumb|webshell)\.php" { return 403; }
